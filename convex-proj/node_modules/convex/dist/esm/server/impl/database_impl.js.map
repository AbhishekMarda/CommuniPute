{
  "version": 3,
  "sources": ["../../../../src/server/impl/database_impl.ts"],
  "sourcesContent": ["import {\n  convexToJson,\n  GenericId,\n  jsonToConvex,\n  Value,\n} from \"../../values/index.js\";\nimport { performAsyncSyscall } from \"./syscall.js\";\nimport { DatabaseReader, DatabaseWriter } from \"../database.js\";\nimport { QueryInitializerImpl } from \"./query_impl.js\";\nimport { GenericDataModel, GenericDocument } from \"../data_model.js\";\nimport { validateArg } from \"./validate.js\";\n\nexport function setupReader(): DatabaseReader<GenericDataModel> {\n  return {\n    get: async (id: GenericId<string>) => {\n      const args = { id: convexToJson(id) };\n      const syscallJSON = await performAsyncSyscall(\"get\", args);\n      return jsonToConvex(syscallJSON) as GenericDocument;\n    },\n    query: (tableName: string) => new QueryInitializerImpl(tableName),\n  };\n}\n\nexport function setupWriter(): DatabaseWriter<GenericDataModel> {\n  const reader = setupReader();\n  return {\n    get: reader.get,\n    query: reader.query,\n\n    insert: async (table, value) => {\n      validateArg(table, 1, \"insert\", \"table\");\n      validateArg(value, 2, \"insert\", \"value\");\n      const syscallJSON = await performAsyncSyscall(\"insert\", {\n        table,\n        value: convexToJson(value),\n      });\n      const syscallResult = jsonToConvex(syscallJSON) as any;\n      return syscallResult._id;\n    },\n    patch: async (id, value) => {\n      validateArg(id, 1, \"patch\", \"id\");\n      validateArg(value, 2, \"patch\", \"value\");\n      await performAsyncSyscall(\"update\", {\n        id: convexToJson(id),\n        value: convexToJson(value as Value),\n      });\n    },\n    replace: async (id, value) => {\n      validateArg(id, 1, \"replace\", \"id\");\n      validateArg(value, 2, \"replace\", \"value\");\n      await performAsyncSyscall(\"replace\", {\n        id: convexToJson(id),\n        value: convexToJson(value),\n      });\n    },\n    delete: async id => {\n      validateArg(id, 1, \"delete\", \"id\");\n      await performAsyncSyscall(\"remove\", { id: convexToJson(id) });\n    },\n  };\n}\n"],
  "mappings": ";AAAA;AAAA,EACE;AAAA,EAEA;AAAA,OAEK;AACP,SAAS,2BAA2B;AAEpC,SAAS,4BAA4B;AAErC,SAAS,mBAAmB;AAErB,gBAAS,cAAgD;AAC9D,SAAO;AAAA,IACL,KAAK,OAAO,OAA0B;AACpC,YAAM,OAAO,EAAE,IAAI,aAAa,EAAE,EAAE;AACpC,YAAM,cAAc,MAAM,oBAAoB,OAAO,IAAI;AACzD,aAAO,aAAa,WAAW;AAAA,IACjC;AAAA,IACA,OAAO,CAAC,cAAsB,IAAI,qBAAqB,SAAS;AAAA,EAClE;AACF;AAEO,gBAAS,cAAgD;AAC9D,QAAM,SAAS,YAAY;AAC3B,SAAO;AAAA,IACL,KAAK,OAAO;AAAA,IACZ,OAAO,OAAO;AAAA,IAEd,QAAQ,OAAO,OAAO,UAAU;AAC9B,kBAAY,OAAO,GAAG,UAAU,OAAO;AACvC,kBAAY,OAAO,GAAG,UAAU,OAAO;AACvC,YAAM,cAAc,MAAM,oBAAoB,UAAU;AAAA,QACtD;AAAA,QACA,OAAO,aAAa,KAAK;AAAA,MAC3B,CAAC;AACD,YAAM,gBAAgB,aAAa,WAAW;AAC9C,aAAO,cAAc;AAAA,IACvB;AAAA,IACA,OAAO,OAAO,IAAI,UAAU;AAC1B,kBAAY,IAAI,GAAG,SAAS,IAAI;AAChC,kBAAY,OAAO,GAAG,SAAS,OAAO;AACtC,YAAM,oBAAoB,UAAU;AAAA,QAClC,IAAI,aAAa,EAAE;AAAA,QACnB,OAAO,aAAa,KAAc;AAAA,MACpC,CAAC;AAAA,IACH;AAAA,IACA,SAAS,OAAO,IAAI,UAAU;AAC5B,kBAAY,IAAI,GAAG,WAAW,IAAI;AAClC,kBAAY,OAAO,GAAG,WAAW,OAAO;AACxC,YAAM,oBAAoB,WAAW;AAAA,QACnC,IAAI,aAAa,EAAE;AAAA,QACnB,OAAO,aAAa,KAAK;AAAA,MAC3B,CAAC;AAAA,IACH;AAAA,IACA,QAAQ,OAAM,OAAM;AAClB,kBAAY,IAAI,GAAG,UAAU,IAAI;AACjC,YAAM,oBAAoB,UAAU,EAAE,IAAI,aAAa,EAAE,EAAE,CAAC;AAAA,IAC9D;AAAA,EACF;AACF;",
  "names": []
}
