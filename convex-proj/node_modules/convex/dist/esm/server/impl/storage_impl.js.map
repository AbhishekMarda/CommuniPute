{
  "version": 3,
  "sources": ["../../../../src/server/impl/storage_impl.ts"],
  "sourcesContent": ["import {\n  StorageReader,\n  StorageWriter,\n  StorageId,\n  FileMetadata,\n} from \"../storage.js\";\nimport { performAsyncSyscall } from \"./syscall.js\";\nimport { validateArg } from \"./validate.js\";\n\nexport function setupStorageReader(): StorageReader {\n  return {\n    getUrl: async (storageId: StorageId) => {\n      validateArg(storageId, 1, \"getUrl\", \"storageId\");\n      return await performAsyncSyscall(\"storageGetUrl\", { storageId });\n    },\n    getMetadata: async (storageId: StorageId): Promise<FileMetadata> => {\n      return await performAsyncSyscall(\"storageGetMetadata\", { storageId });\n    },\n  };\n}\n\nexport function setupStorageWriter(): StorageWriter {\n  const reader = setupStorageReader();\n  return {\n    generateUploadUrl: async () => {\n      return await performAsyncSyscall(\"storageGenerateUploadUrl\", {});\n    },\n    delete: async (storageId: StorageId) => {\n      await performAsyncSyscall(\"storageDelete\", { storageId });\n    },\n    getUrl: reader.getUrl,\n    getMetadata: reader.getMetadata,\n  };\n}\n"],
  "mappings": ";AAMA,SAAS,2BAA2B;AACpC,SAAS,mBAAmB;AAErB,gBAAS,qBAAoC;AAClD,SAAO;AAAA,IACL,QAAQ,OAAO,cAAyB;AACtC,kBAAY,WAAW,GAAG,UAAU,WAAW;AAC/C,aAAO,MAAM,oBAAoB,iBAAiB,EAAE,UAAU,CAAC;AAAA,IACjE;AAAA,IACA,aAAa,OAAO,cAAgD;AAClE,aAAO,MAAM,oBAAoB,sBAAsB,EAAE,UAAU,CAAC;AAAA,IACtE;AAAA,EACF;AACF;AAEO,gBAAS,qBAAoC;AAClD,QAAM,SAAS,mBAAmB;AAClC,SAAO;AAAA,IACL,mBAAmB,YAAY;AAC7B,aAAO,MAAM,oBAAoB,4BAA4B,CAAC,CAAC;AAAA,IACjE;AAAA,IACA,QAAQ,OAAO,cAAyB;AACtC,YAAM,oBAAoB,iBAAiB,EAAE,UAAU,CAAC;AAAA,IAC1D;AAAA,IACA,QAAQ,OAAO;AAAA,IACf,aAAa,OAAO;AAAA,EACtB;AACF;",
  "names": []
}
